## 对服务器进行进一步排查

------

我是应急响应工程师，由网站运维工程师排查发现本服务器使用的操作系统是linux，下面对服务器进行进一步排查，我将会对本服务器的用户账户、历史命令、存放系统核心命令目录、进程信息、系统启动机制、特殊权限suid、定时任务、是否有在/etc目录下有残留 

/etc 存放系统的**配置文件**  /etc/ssh/sshd_config  /var/www/html/info.php

**时间先后顺序进行排序的**

## 1.对用户账户进行排查

用cat对用户账户进行排查，先查看用户 `/etc/passwd`文件 再查看密码`/etc/shadow` 文件，重点关注是否存在UID为0的非法管理员账户，以及是否有新增的异常用户。
 经过排查，未发现未授权的管理账户或其他可疑账户，用户配置符合预期。

------

## 2、对历史命令进行审计

使用 `history` 命令审阅系统操作历史，重点关注是否有高危命令执行记录，以及敏感文件是否遭到篡改。
 审计结果显示，历史命令无高危操作，重要配置文件也未出现异常修改。

------

## 3、对系统核心命令完整性进行检查

对`/usr/bin` 和 `/bin` 这两个存放系统核心命令的目录进行检查，使用 `ls -a -ltr` 排查是否存在核心命令被篡改。
 经过核查，这些目录中**文件处于系统正常安装时的时间**，是按照**时间先后顺序进行排序的**，近期无异常变动，且未发现隐藏的可疑文件或程序。

------

## 4、对进程进行排查

对进程进行排查，使用命令 `ps aux` ， 发现PID为965的进程正在执行./prism程序。
 由于相对路径，单从进程信息无法直接定位其文件所在的绝对路径。

### 5、对系统启动机制进行综合排查

**为了排除是否是启动脚本自动拉起了这个进程**，使用命令`ls -a`检查 `/etc/init.d/` 目录下的系统初始化脚本，确认无新增或被篡改的启动脚本。

使用命令cat审阅 `/etc/profile` 全局环境配置文件，未发现被植入恶意命令或环境变量，系统启动流程正常。

通过 `runlevel` 确认当前为运行级别5，检查 `/etc/rc5.d/`（系统运行级别5的启动目录）
系统启动服务配置正常，无异常自启动项目。

这一轮排查说明，prism 程序的启动方式可能隐藏得更深，极有可能是通过 **定时任务** 实现的持久化。

------

## 6、对定时任务进行审计

对定时任务进行审计，我检查了定时任务配置（`crontab -e`）。
 在定时任务中发现异常：

```sh
@reboot cd /root/.mal/; ./prism
```

分析可知，每次系统重启时，都会自动进入 `/root/.mal/` 目录，并执行隐藏目录下的 `prism` 程序。
这是典型的 **开机自启动攻击机制**。攻击者通过该手法保证程序在每次重启后自动恢复运行，说明服务器已经**被持久控制**。

------

## 7、查异常配置的残留痕迹

查异常配置的残留痕迹，我通过 `grep -rni "prism" /etc/` 检索，发现 `/etc/` 目录下有其他与 `prism` 相关的异常配置或残留痕迹。我的应急排查任务完成了 排查结果 恶意程序在本服务器路径为/root/.mal下

-----

## 8、对特殊权限文件（SUID）进行排查

对特殊权限文件（SUID）进行排查，使用命令 `find / -perm /4000 -type f 2>/dev/null` 排查系统中所有具有SUID权限的文件。
 结果显示，系统内SUID文件均为常规文件，未发现新增或被利用的提权文件。

### 9.确定绝对路径位置

下一步 确认prism程序的绝对路径 使用命令cd进入到目录/root/.mal/目录 使用 ls -a命令发现prism程序 使用命令pwd查看绝对路径 成功确认了恶意程序的绝对路径存在于/root/.mal/目录下 ，完成排查流程 排查完毕 交给任务负责人
